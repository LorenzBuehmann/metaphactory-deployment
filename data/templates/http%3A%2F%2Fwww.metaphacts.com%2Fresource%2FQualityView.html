<!-- Trigger -->
<button id="recomputeAndValidate" class="btn btn-primary">Recompute & validate</button>

<!-- 1) Button click → SPARQL UPDATE (re)builds helper triples -->
<mp-event-proxy
  on-event-source="recomputeAndValidate"
  on-event-type="click"
  proxy-event-type="SemanticUpdate.Execute"
  proxy-targets='["update-archived-helpers"]'>
</mp-event-proxy>

<semantic-update
  id="update-archived-helpers"
  show-confirmation="false"
  redirect="event"
  query="
PREFIX owl:  <http://www.w3.org/2002/07/owl#>
PREFIX bibo: <http://purl.org/ontology/bibo/>
PREFIX pso:  <http://purl.org/spar/pso/>
PREFIX qa:   <urn:qa:>

DELETE { GRAPH ?g { <{{iri}}> qa:importsArchived ?o . } }
INSERT { GRAPH ?g { <{{iri}}> qa:importsArchived ?o . } }
WHERE  {
  BIND(IRI('{{iri}}') AS ?this)
  BIND(?this AS ?g)  # adjust if graph IRI ≠ ontology IRI
  GRAPH ?g { ?this a owl:Ontology ; owl:imports ?o . }
  GRAPH ?o { ?o bibo:status pso:archived . }
}">
</semantic-update>

<!-- 2) After UPDATE → run Data Quality via REST *inside a semantic-form* -->
<semantic-form id="dqForm" persistence="true">
  <semantic-form-rest-persistence
    id="dq-run"
    method="POST"
    url="/rest/jobs/data-quality/run"
    payload='{
      "configurationId": "ontologies-checks",
      "scope": { "semanticContext": "ontologies-union" },
      "labels": { "resource": "{{iri}}" }
    }'>
  </semantic-form-rest-persistence>
</semantic-form>

<mp-event-proxy
  on-event-source="update-archived-helpers"
  on-event-type="SemanticUpdate.Success"
  proxy-event-type="Form.Persist"
  proxy-targets='["dqForm"]'>
</mp-event-proxy>
